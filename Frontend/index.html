<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Socket.IO Chat</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <div id="connection-panel">
        <h1>Socket.IO Chat</h1>
        <div class="connection-options">
          <button id="host-btn">Host Chat Server</button>
          <div class="connect-form">
            <input
              type="text"
              id="server-address"
              placeholder="Server address (e.g., http://localhost:3000)"
            />
            <button id="connect-btn">Connect</button>
          </div>
        </div>
      </div>

      <div id="chat-panel" style="display: none">
        <div class="connection-status">
          Status: <span id="status">Disconnected</span>
        </div>

        <div class="username-form">
          <input
            type="text"
            id="username-input"
            placeholder="Enter your username"
          />
          <button id="set-username">Set Username</button>
        </div>

        <div id="messages"></div>

        <div class="message-input">
          <input
            type="text"
            id="message-input"
            placeholder="Type your message"
            disabled
          />
          <button id="send-btn" disabled>Send</button>
        </div>
      </div>
    </div>

    <script>
      const { ipcRenderer } = require("electron");

      document.getElementById("host-btn").addEventListener("click", () => {
        ipcRenderer.send("host-server");
      });

      document.getElementById("connect-btn").addEventListener("click", () => {
        const address = document.getElementById("server-address").value;
        if (address) {
          ipcRenderer.send("connect-to-server", address);
        }
      });

      document.getElementById("set-username").addEventListener("click", () => {
        const username = document.getElementById("username-input").value;
        if (username) {
          ipcRenderer.send("set-username", username);
          document.getElementById("username-input").disabled = true;
          document.getElementById("set-username").disabled = true;
          document.getElementById("message-input").disabled = false;
          document.getElementById("send-btn").disabled = false;
        }
      });

      document.getElementById("send-btn").addEventListener("click", () => {
        const message = document.getElementById("message-input").value;
        if (message) {
          ipcRenderer.send("send-message", message);
          document.getElementById("message-input").value = "";
        }
      });

      document
        .getElementById("message-input")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            document.getElementById("send-btn").click();
          }
        });

      ipcRenderer.on("connection-status", (event, status) => {
        document.getElementById("status").textContent = status;
        if (status === "connected") {
          document.getElementById("connection-panel").style.display = "none";
          document.getElementById("chat-panel").style.display = "block";
        }
      });

      ipcRenderer.on("new-message", (event, data) => {
        const messages = document.getElementById("messages");
        const messageElement = document.createElement("div");
        messageElement.className = "message";

        const userElement = document.createElement("span");
        userElement.className = "user";
        userElement.textContent = data.user + ": ";

        const textElement = document.createElement("span");
        textElement.className = "text";
        textElement.textContent = data.message;

        messageElement.appendChild(userElement);
        messageElement.appendChild(textElement);
        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;
      });
    </script>
  </body>
</html>
